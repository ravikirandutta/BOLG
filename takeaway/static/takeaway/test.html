<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>To-do App in Backbone.js</title>

  <!-- ========= -->
  <!--    CSS    -->
  <!-- ========= -->
  <style type="text/css">

  </style>
</head>
<body>
  <!-- ========= -->
  <!-- Your HTML -->
  <!-- ========= -->

  <section id="todoapp">

  </section>



  <!-- ========= -->
  <!-- Libraries -->
  <!-- ========= -->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js" type="text/javascript"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js" type="text/javascript"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone-localstorage.js/1.1.9/backbone.localStorage-min.js" type="text/javascript"></script>


  <!-- =============== -->
  <!-- Javascript code -->
  <!-- =============== -->
  <script type="text/javascript">



  var Takeaway = Backbone.Model.extend({
    urlRoot: '/takeaways/'
  });
    var TakeawayView = Backbone.View.extend({

        render: function(){
            var template = _.template($('#takeaway-template').html(),this.model.toJSON());
            $(this.el).html(template);
            return this;
        }
    });

    var TakeawayList = Backbone.Collection.extend({
        model: Takeaway
    });

    var TakeawayListView = Backbone.View.extend({

        render: function(){
            this.collection.forEach(this.addOne,this);
            return this;
        },
        addOne: function(takeaway){
              var takeawayView = new TakeawayView({model:takeaway});
              this.$el.append(takeawayView.render().el);
        }
    });

var takeaway = new Takeaway();
takeaway.fetch();

var takeawayList = new TakeawayList();
   var takeaways = takeawayList.fetch();


var TakeawayRouter = Backbone.Router.extend({
  routes:{
    "takeaways?format=json":"getTakeaways"
  }
});
var takeawayRouter = new TakeawayRouter;

takeawayRouter.on('route:getTakeaways', function(response){
    var takeawayListView = new TakeawayListView({collection:takeaways});
    takeawayListView.render();
    $("#todoapp").html(takeawayListView.$el.html());

});






var Appointment = Backbone.Model.extend({
  defaults:{first:'sagar',last:'dutta', status:'incomplete'},
  toggleStatus: function(){
    if(this.get('status')=== 'incomplete'){
      this.set({status:'complete'});
    }else{
      this.set({status:'incomplete'});
    }
  }
});

var AppointmentList = Backbone.Collection.extend({
  model:Appointment,
  localStorage:  new Store("appointments")
});

var appointment = new Appointment({first:'Cathy', last:'Vary'});

var AppointmentView = Backbone.View.extend({
  template: _.template('<h3><input type=checkbox '+'<% if(status === "complete") print("checked") %>/>'+'<%= first %></h3>'),
  initialize: function(){
    this.model.on('change', this.render, this);
  },
  render: function(){
    this.$el.html(this.template(this.model.toJSON()));
    return this;
  },
  events: {
    'change input':'togglestatus',
    'dblclick input':'edit'
  },
  togglestatus: function(){
    this.model.toggleStatus();
  },

  edit: function(){

  }
});


var appointmentList = new AppointmentList();
var appointment1 = new Appointment({first:'sagar',last:'dutta'});
var appointment2 = new Appointment({first:'ravi',last:'dutta'});
var appointment3 = new Appointment({first:'sada',last:'dutta'});
appointmentList.add(appointment1);
appointmentList.add(appointment2);
appointmentList.add(appointment3);



var AppointmentListView =  Backbone.View.extend({
initialize: function(){
  this.collection.on('add',this.addOne,this);
  this.collection.on('reset',this.addAll,this);
},
 addOne:  function(nameModel){
    var view = new AppointmentView({model:nameModel});
    this.$el.append(view.render().el);
  },

  render:function(){
    this.addAll();
  },
  addAll: function(){
    this.collection.forEach(this.addOne,this);
  }

});
var appointmentListView = new AppointmentListView({collection:appointmentList});
appointmentListView.render();
</script>

</body>
</html>


