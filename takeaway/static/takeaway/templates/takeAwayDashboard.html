<div ng-controller="takeawayDashboardCtrl">

  <div class="content">
    <div class="mainbar">
      <div id="course-list" class="page-head">
        <ui class="nav nav-pills" >
          <li class="course {{courseresult.courseClass}}" ng-repeat="courseresult in availableCourses.results" >
            <a class="course-item" ng-click="freshLoadOfSessions(courseresult.course.id)" id="{{courseresult.course.id}}_course">
                <span id="course{{courseresult.course.id}}">
                    <i class="fa fa-folder-open"></i>
                    <b>{{courseresult.course.course_name}}</b>
                </span>
            </a>
          </li>
        </ui>
        <div class="clearfix"></div>
      </div>
      <div class="col-md-6" id="takeaway-container">
      <div ng-show="displaysessions">
        <div ng-repeat="sessionsresult in sessions.results">
          <div class="widget wlightblue">
              <div class="widget-head">
                <div class="pull-left">
                  {{sessionsresult.session_name}}
                  <a id="edit-session-link" href="#" class="glyphicon glyphicon-edit" title="Edit Session"
                      ng-click="editSessionName(sessionsresult)"></a>
                </div>
                <div class="widget-icons pull-right">
                   <a href="#" class="btn btn-primary" style="background:#e1e3e4 !important;color:#000"
                      ng-click="newTakeaway(sessionsresult)">
                      <span class="glyphicon glyphicon-pencil"></span> New Takeaway
                    </a>
                   <a href="#" class="wminimize"><i class="fa fa-chevron-up"></i></a>
                   <a href="#" class="wclose"><i class="fa fa-times"></i></a>
                </div>
                <div class="clearfix"></div>
              </div>
              <div class="widget-content">
                  <div class="padd">

                    <ul id="takeaway-list" class="recent">
                      <div>
                        <div ng-repeat="taset in sessionsresult.takeaway_set">
                          <li>
                            <div id="{{sessionsresult.id}}_{{taset.id}}_view" class="recent-content">
                              <div class="recent-meta">Posted on {{taset.created_dt}} by {{taset.username}}</div>
                              <div ng-if="taset.isOwner">
                                <div id="editable-notes" title="Click to edit the takeaway" style="cursor: pointer;"
                                     ng-click="makeEditable(sessionsresult.id+'_'+taset.id, taset.notes)" >
                                  <pre id="takeaway" class="takeaway-pre takeaway-pre-owner" ><div ng-bind-html="taset.notes"></div ></pre>
                                </div>
                              </div>
                              <div ng-if="!taset.isOwner">
                                <div id="editable-notes">
                                  <pre id="takeaway" class="takeaway-pre">{{taset.notes}}</pre>
                                </div>
                              </div>
                              <div class="btn-group" style="float: right; display: block;">
                                <div ng-if="taset.isOwner">
                                  <button id="update" class="btn btn-xs btn-primary" title="Edit"
                                          style="margin-left: 5px;" ng-click="makeEditable(sessionsresult.id+'_'+taset.id, taset.notes)">
                                    <i class="fa fa-pencil-square-o fa-lg"></i>
                                  </button>
                                  <button id="delete" class="btn btn-xs btn-danger" title="Delete"
                                          style="margin-left: 5px;" ng-click="deleteTakeaway(sessionsresult, taset)">
                                    <i class="fa fa-trash-o fa-lg"></i>
                                  </button>
                                </div>
                              </div>
                              <div class="btn-group-left">
                                <span ng-repeat="tag in taset.tags">
                                  <span class="label label-warning">
                                    <i class="fa fa-tags"></i>{{tag.name}}
                                  </span>
                                  <span style="width:2px">&nbsp;</span>
                                </span>

                                <span ng-if="!taset.isOwner">
                                  {{taset.average_rating}}
                                  <div class="rateit" data-rateit-value={{taset.average_rating}} data-rateit-ispreset="true" data-rateit-readonly={{taset.alreadyRated}} data-rateit-resetable="false"></div>
                                  <span class="total-raters">(<i class="fa fa-user"></i>{{taset.total_raters}})</span>
                                </span>

                                <span ng-if="taset.isOwner">
                                  {{taset.average_rating}}
                                  <div class="rateit" data-rateit-value={{taset.average_rating}} data-rateit-ispreset="true" data-rateit-readonly="true" data-rateit-resetable="false"></div>

                                  <span class="total-raters">(<i class="fa fa-user"></i>{{taset.total_raters}})</span>

                                  <span public-private taset="taset"
                                       course-id={{sessionsresult.courseInstance.id}}
                                       session-id={{sessionsresult.id}}
                                       perform-post=true></span>

                                </span>
                              </div>
                              <div id="favourite">


                                <span ng-if="taset.isFavourite">
                                  <a>
                                    <span id="myfav" class="glyphicon glyphicon-heart" ng-click="makeFavourite(taset)"></span>
                                  </a>
                                </span>
                                <span ng-if="!taset.isFavourite">
                                  <a ng-click="makeFavourite(taset)">
                                    <span id="myfav" class="glyphicon glyphicon-heart-empty" ng-click="makeFavourite(taset)"></span>
                                  </a>
                                </span>
                              </div>
                              <div class="clearfix"></div>

                            </div>


                            <div id="{{sessionsresult.id}}_{{taset.id}}_edit" style="display: none;height:210px;">
                              <textarea rows="5" class="form-control" id="{{sessionsresult.id}}_{{taset.id}}_notes"></textarea>
                              <br/>
                               <div style="float:right">
                              <span public-private taset="taset"
                                   course-id={{sessionsresult.courseInstance.id}}
                                   session-id={{sessionsresult.id}}
                                   perform-post=false></span>

                              <button class="btn btn-success" ng-click="updateTakeaway(sessionsresult.id+'_'+taset.id, taset)">Update</button>
                              <button class="btn btn-danger" ng-click="cancelEdit(sessionsresult.id+'_'+taset.id, taset.notes)">Cancel</button>
                            </div>
                              <div class="btn-group-left" >
                               <!-- <span ng-repeat="tag in taset.tags">
                                  <span class="label label-warning">
                                    <i class="fa fa-tags"></i>{{tag.name}}
                                  </span>
                                  <span style="width:2px">&nbsp;</span>
                                </span>
                -->
                                <tags-input  placeholder="Add a Tag by typing it" ng-model="taset.tags" display-property="name"
                                on-tag-added="tagAddedInEditTakeaway($tag)">
                                      <auto-complete source="loadTags($query)"></auto-complete>
                                </tags-input>

                              <div>

                              <br/>
                            </div>
                          </li>
                        </div>
                      </div>
                    </ul>
                  </div>
              </div>
          </div>
         </div>
      </div>
      </div>
    </div>
  </div>
</div>

<script type="text/ng-template" id="newTakeawayTemplateId">
    <div id="create-takeaway-container" class="ngdialog-message">
      <h5>New Takeaway for {{sessionsresult.session_name}}</h5>
      <div class="row1">
        <textarea rows="5" data-ui-tinymce data-ng-model="newTakeawayContent" class="form-control" id="notes"></textarea>
      </div>


    <tags-input placeholder="Add a Tag by typing it" ng-model="tags" display-property="name"  on-tag-added="tagAdded($tag)">
       <auto-complete source="loadTags($query)"></auto-complete>
    </tags-input>


      <span public-private taset="taset"
           course-id={{sessionsresult.courseInstance.id}}
           session-id={{sessionsresult.id}}
           perform-post=false></span>

    </div>
    <div class="ngdialog-buttons">
      <button type="button" class="ngdialog-button ngdialog-button-secondary" ng-click="closeDialog()"
      ng-dialog-class="ngdialog-theme-default" >Close</button>
      <button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="saveTakeaway(sessionsresult)">Save</button>
    </div>
</script>

<script type="text/ng-template" id="editSessionNameTemplateId">
    <div class="ngdialog-message">
      <h5>Editing Session "{{session_name_current}}"</h5>
      <textarea class="form-control" id="editedSessionName" ng-model="modifiedSession.session_name"></textarea>
    </div>
    <div class="ngdialog-buttons">
      <button type="button" class="ngdialog-button ngdialog-button-secondary" ng-click="closeDialog()"
        ng-dialog-class="ngdialog-theme-default" >Close</button>
      <button type="button" class="ngdialog-button ngdialog-button-primary"
        ng-click="updateSessionName(modifiedSession, sessionsresult)">Update</button>
    </div>
  </div>
</script>
